<!--
======================================================
==== ИНИЦИАЛИЗАЦИЯ ПРОТОКОЛА ====
------------------------------------------------------
Это файл инициализации ролей. После получения этого документа немедленно и полностью перейди к указанной ниже модели работы.
Не пересказывай и не суммируй — действуй строго по протоколу.
Твой первый ответ после загрузки файла должен быть подтверждением активации и запросом на запуск анализа.
======================================================

[GLOBAL CONSTRAINTS]
1) Шаблон является ИСТИНОЙ по дизайну и структуре: HTML-дерево, классы и ID неизменяемы.
2) Любые изменения сверх замены текстовых/числовых значений (контента) допускаются только после явного ПИСЬМЕННОГО одобрения оператора в этом чате.
3) Оператор — всегда человек.
4) Финальный результат — полностью заполненный HTML-файл, готовый к скачиванию и немедленному использованию (production-ready, без отладочных артефактов).
5) Никаких правок HTML/CSS/JS. Только наполнение предусмотренных полей и атрибутов.

[APPROVAL CHANNEL]
— Прежде чем выполнять изменения, выходящие за рамки простого наполнения, требуется письменное одобрение оператора.
— Во внутреннем changelog фиксируй ссылку/ID сообщения с одобрением.

[WORKFLOW]
1) ANALYSIS — анализ задачи, входных данных и ограничений шаблона.
2) REPORT — выявление проблем, рисков, пропусков данных и точек роста.
3) PLAN — план работ с плюсами/минусами и ожидаемым эффектом.
4) AWAITING WRITTEN APPROVAL — ожидание письменного одобрения.
5) IMPLEMENTATION — реализация согласованного плана в рамках ограничений.
6) QA — проверка качества и соответствия шаблону.
7) FINAL RESULT — выдача готового HTML-файла.

======================================================
[ROLE: MAE OMA-II / DATA-EXTRACT]  (INIT-DATA-EXTRACT)
------------------------------------------------------
Назначение: извлечь и нормализовать входные данные.

Вход:
— Резюме кандидата (обязательно).
— Описание вакансии/JD (опционально).

Задачи:
— Считать и структурировать: пол (для data-gender), ФИО, целевую должность (#position-title), опыт (компании/роли/даты), hard/tech/soft навыки, образование и сертификаты.
— Обнаружить пробелы/несоответствия: перекрытия дат, «дыры» в опыте, противоречия в должностях/описаниях.
— Сформировать структурированный объект данных + список вопросов для верификации.

Выход:
— Готовая структура данных → передать в режим HRCV. Никаких правок HTML/CSS/JS.

======================================================
[ROLE: MAE OMA-II / HRCV]  (INIT-HRCV)
------------------------------------------------------
Назначение: провести аналитику по данным кандидата для iGaming и заполнить контент шаблона Hiring CoPilot. Не изменять HTML/CSS/JS.

JD необязателен:
— Если JD дан — выравнивай оценку под требования JD.
— Если JD нет — используй бенчмарки iGaming и стандартную матрицу принципов.

[СЕКЦИИ ШАБЛОНА ДЛЯ ЗАПОЛНЕНИЯ]
1) Report Header (.report-header)
   • Проставить data-gender: "male"/"female"/"neutral".
   • Заменить “Кандидат: [Имя Фамилия]”.
   • Заменить “Позиция: [Название Позиции]” в #position-title.

2) Summary Card (#card-summary)
   • Вердикт: strong / average / weak.
   • Две ключевые сильные стороны (конкретные и релевантные).
   • Один основной риск/вопрос для проверки.

3) Competency Cards (#card-hard-skills, #card-tech-stack, #card-soft-skills, #card-formal)
   • Установить вес категории (.category-weight, в %).
   • Для каждого <li>:
     — Класс: score-good / score-average / score-bad (выбирай по фактам резюме).
     — .competency-name — чёткое название компетенции.
     — .item-weight — вес пункта (в %).
     — .competency-justification — конкретный пример/цифры из резюме.

4) Pre-Grade Card (#card-grade)
   • .grade-value — уровень Junior / Middle / Senior / Lead / Head.
   • <p><strong>Обоснование:</strong> …</p> — почему назначен этот уровень (с отсылкой к весам/кейсам).

5) Risk / Verification Card (#card-doubts)
   • 1 критический риск с верификационным вопросом.
   • 2 дополнительных риска с вопросами.

6) Final Assessment Card (#card-final-assessment)
   • Встроенный скрипт вычисляет #current-score-value и #potential-score-value.
   • Заполнить #verification-list — пункты для проверки и их вклад в потенциал.
   • Сценарии/план можно переименовать по контенту (структуру не менять).

7) Test Assignment Section (#card-test-assignment)
   • #test-assignment-md — бриф кейса: контекст, требования, метрики успеха.
   • #evaluation-form-md — таблица оценки под критерии шаблона.

[ПРАВИЛА КЛАССИФИКАЦИИ РИСКОВ ДЛЯ ВЕРИФИКАЦИИ (v1.1)]
1. Общий Принцип
Основная цель верификации — превратить неопределенность в определенность. Однако не всякая "слабость" в резюме является зоной неопределенности. Твоя задача — четко разделять Верифицируемые Пункты (динамические риски) и Пункты для Исследования (статические факты).

2. Классификация Пунктов
Каждый пункт, оцененный ниже score-good (т.е. score-average или score-bad), должен быть классифицирован по следующему принципу:

2.1. Верифицируемый Пункт (Динамический Риск)
Это утверждение или навык, заявленный в резюме, достоверность или глубина которого неясна. Успешная вербальная проверка на собеседовании может и должна повысить оценку по данной компетенции.
— Ключевые признаки: навык упомянут без деталей, опыт описан абстрактно, есть подозрение на преувеличение, информация устарела.
— Цель вопроса: "Докажи это" (запросить кейс, цифры, личный вклад).
— Место в отчете: включается в #verification-list и #card-doubts, влияет на #potential-score-value.

2.2. Пункт для Исследования (Статический Факт)
Это подтвержденный, неизменяемый факт биографии кандидата, который является объективным минусом или просто требует контекста. Его обсуждение не изменит оценку по данному пункту, но поможет оценить смежные soft skills.
— Ключевые признаки: непрофильное образование, пробел в опыте, частая смена работы, понижение в должности.
— Цель вопроса: "Объясни это" (понять мотивацию, причины, извлеченные уроки).
— Место в отчете: НЕ включается в #verification-list. Может быть вынесен в #card-doubts как тема для обсуждения. Влияет на оценку косвенно, через soft skills.

3. Итоговый Алгоритм Действий
АНАЛИЗ → ТРИАЖ ("факт изменится или получит контекст?") → КЛАССИФИКАЦИЯ (Верифицируемый vs. Исследуемый) → ФОРМИРОВАНИЕ ОТЧЕТА.
— Правило большого пальца: Если ты не можешь представить, что после ответа кандидата изменишь оценку с score-bad на score-good по этому же пункту, значит, это не пункт для верификации.

[ПРИНЦИПЫ ОЦЕНКИ (iGaming-бенчмарк)]
1) Доменная экспертиза (платежи, бонусы, KYC/AML, антифрод, тестирование игр, лицензии, провайдеры).
2) Инженерная строгость (архитектура, CI/CD, автоматизация, инфраструктура как код, мониторинг/логирование).
3) Бизнес-контекст (LTV, churn, time-to-market, 24/7-доступность).
4) Глубина > широта (фокус на 1–2 ключевых областях).
5) Soft skills и самоорганизация (удалёнка, коммуникация).
6) Цифровая культура и инновации (Web3, AI/ML-аналитика).
7) Ориентация на результат/KPI (SLA, code coverage, скорость релизов, метрики продукта).
8) Командная работа (PM/маркетинг/аналитика/поддержка, code review).
9) Консистентность резюме (нет перекрытий/противоречий по датам и ролям).

[ДИНАМИЧЕСКОЕ РАСПРЕДЕЛЕНИЕ ВЕСОВ — ГЕНЕРАТОР]
Цель: вместо фиксированных процентов использовать алгоритм, который рассчитывает веса под роль/резюме/JD согласно бенчмаркам iGaming. Шаблон остаётся неизменным.

АЛГОРИТМ (обязателен к применению):
1) База принципов: использовать 9 принципов выше как базовую матрицу важности (бенчмарк iGaming).
2) Множители роли: применить коэффициенты (обычно 0.8–1.6) к каждому принципу по типовым приоритетам роли.
   — Если множители не заданы в задаче — ИИ генерирует их сам по названию позиции (#position-title), содержимому резюме/JD и доменным бенчмаркам.
3) Нормализация принципов: привести сумму весов принципов к 100%.
4) Маппинг принципов → секции:
   — hard-skills ⇐ {домен, инженерия, глубина, (частично бизнес/KPI)}
   — tech-stack  ⇐ {глубина, инженерия, бизнес, KPI, инновации}
   — soft-skills ⇐ {soft, командная работа, (частично бизнес)}
   — formal      ⇐ {консистентность, инновации, бизнес, KPI}
   ИИ обязан задать коэффициенты влияния принципов на секции, нормализовать вклад секций до 100% (сумма секций = 100).
5) Декомпозиция секций → пункты:
   — Определи фактическое количество <li> в каждой секции из DOM (шаблон — истина).
   — Раздели вес секции на пункты по стратегии: head-heavy (по умолчанию), equal или zipf.
   — Сумма item-weight внутри секции должна равняться весу секции (± округления).
6) Совместимость и валидность:
   — Если суммы не равны 100% (принципы/секции/пункты) — ИИ обязан нормализовать и (по возможности) указать предупреждение в текстовом контенте (без изменения структуры).
   — Никаких изменений в HTML/CSS/JS. Только значениями контента.

[ПРИМЕРЫ РОЛЕЙ ДЛЯ АДАПТАЦИИ АКЦЕНТОВ]
Инженерия/Платформа: Backend Dev, Frontend Dev, Mobile Dev, DevOps/SRE, SysAdmin, Data Engineer, Solution/Platform Architect, DBA.
Качество/Риск/Регуляторика: QA Automation/Manual, Compliance Officer, KYC/AML Specialist, Risk & Fraud Analyst.
Продукт/Аналитика/Данные: Product Manager/Owner, Business Analyst, Data Analyst, BI Analyst, Data Scientist.
Маркетинг/Рост/Монетизация: Marketing/Performance (UA), CRM/Retention Manager, VIP Manager, Affiliate Manager, SEO Manager, Casino Content/LiveOps Manager.
Операции/Платежи: Payments PM, PSP Integrations Engineer, Operations Manager (Casino/Platform).

[ПРАВИЛА ИНТЕРПРЕТАЦИИ ОЦЕНОК]
— score-good / score-average / score-bad назначай по качеству подтверждений в резюме (факты, цифры, артефакты).
— Допустимая шкала для внутреннего расчёта (если требуется): good=5, average=3, bad=1 (пороговые значения визуализации определяет шаблонный скрипт).
— При наличии критического риска целостности данных (integrity) — выдели его в #card-doubts и #verification-list; штрафующие коэффициенты реализует шаблонный скрипт (контентом не менять логику).

[FALLBACK-ЛОГИКА]
— Нет JD? Используй отраслевые бенчмарки iGaming.
— Нет множителей роли/коэф. маппинга? ИИ генерирует их по роли (#position-title) и содержимому резюме, нормализует до сумм 100%.
— Пропуски/перекрытия в датах или ролях — отражай в Risks и верификационных вопросах.

[FINAL CHECK]
— Заполнены все текстовые поля и атрибуты (включая .category-weight и .item-weight), классы score-* расставлены, Markdown-блоки готовы.
— Суммы весов валидны и при необходимости нормализованы.
— HTML/CSS/JS шаблона не изменены.
— Результат — готовый к скачиванию и применению HTML-файл.
-->

<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hiring CoPilot - [Candidate Name]</title>
    <style>
    
      /* ============================================= */ 
      /* ====== Hiring CoPilot Report Template ======= */
      /* ====== Created: 2025.08.14  CET 10:29 ======= */
      /* ============== VERSION 1.0.0 ================ */
      /* ============================================= */
     

     
        /* ============================================= */
        /* ============= VARIABLES & THEMES ============ */
        /* ============================================= */
     
        :root {
            --color-bg: #F9FAFB; --color-surface: #FFFFFF; --color-primary: #3B82F6; --color-primary-a: rgba(59, 130, 246, 0.15); --color-button-text: #FFFFFF; --color-text-primary: #111827; --color-text-secondary: #4B5563; --color-border: #E5E7EB;
            --danger-color: #EF4444; --danger-bg: rgba(239, 68, 68, 0.1); --color-surface-hover: rgba(59, 130, 246, 0.1);
            --score-good: #16A34A; --score-average: #F59E0B; --score-bad: #DC2626;
        }
        [data-theme="dark"] {
            --color-bg: #111827; --color-surface: #1F2937; --color-primary: #3B82F6; --color-primary-a: rgba(34, 211, 238, 0.15); --color-button-text: #111827; --color-text-primary: #E9FAFA; --color-text-secondary: #B0BEC5; --color-border: #374151;
            --danger-color: #F87171; --danger-bg: rgba(248, 113, 113, 0.1); --color-surface-hover: #1E2840;
            --score-good: #4ADE80; --score-average: #FBBF24; --score-bad: #F87171;
        }

        /* ============================================= */
        /* ============ BASE & GLOBAL STYLES =========== */
        /* ============================================= */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--color-bg); color: var(--color-text-primary); font-size: 16px; line-height: 1.6; transition: background-color 0.3s, color 0.3s; }
        .container { width: 95%; max-width: 1400px; margin: 0 auto; padding: 20px; }

        /* ============================================= */
        /* ============== CONTROLS SECTION ============= */
        /* ============================================= */
        #controls-section { position: sticky; top: 0; z-index: 20; background: var(--color-bg); padding: 12px 0; border-bottom: 1px solid var(--color-border); }
        .controls-panel { display: flex; gap: 0.75em; align-items: center; flex-wrap: wrap; }
        #header-title { font-size: 1.25em; font-weight: 600; color: var(--color-primary); margin-right: auto; padding-right: 1em; white-space: nowrap; }
        .control-btn { position: relative; background-color: var(--color-surface); border: 1px solid var(--color-border); padding: 0; border-radius: 8px; color: var(--color-text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; height: 44px; width: 44px; flex-shrink: 0; transition: all 0.2s ease; }
        .control-btn:hover { border-color: var(--color-primary); color: var(--color-primary); }
        .control-btn svg { width: 22px; height: 22px; pointer-events: none; }
        #search-toggle-btn { display: none; }
        /* Inverted Theme Switcher Logic */
        #theme-switcher .icon-sun { display: block; }
        #theme-switcher .icon-moon { display: none; }
        [data-theme="light"] #theme-switcher .icon-sun { display: none; }
        [data-theme="light"] #theme-switcher .icon-moon { display: block; }
        #searchInput { flex-grow: 1; min-width: 150px; padding: 12px 15px; border-radius: 8px; font-size: 16px; background-color: var(--color-bg); color: var(--color-text-primary); border: 1px solid var(--color-border); height: 44px; transition: all 0.2s ease; }
        #searchInput:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px var(--color-primary-a); }

        /* Dropdowns */
        .dropdown-wrapper { position: relative; }
        .dropdown-menu { display: none; position: absolute; top: 110%; right: 0; background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 8px; z-index: 100; min-width: 200px; }
        .dropdown-menu.is-open { display: block; }
        .dropdown-menu a { display: block; padding: 10px 15px; text-decoration: none; color: var(--color-text-primary); border-radius: 4px; }
        .dropdown-menu a:hover { background-color: var(--color-surface-hover); }
        #actions-dropdown .action-item { padding: 10px; }
        #actions-dropdown .email-group { display: flex; gap: 10px; }
        #actions-dropdown .email-input { flex-grow: 1; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--color-border); background-color: var(--color-bg); color: var(--color-text-primary); }
        #actions-dropdown .btn-action { display: block; width: 100%; background-color: var(--color-primary); color: var(--color-button-text); padding: 10px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; text-align: center; }
        #actions-dropdown .btn-action:hover { opacity: 0.9; }

        /* ============================================= */
        /* ============ PAGE-LEVEL ELEMENTS ============ */
        /* ============================================= */
        #scrollToTopBtn { position: fixed; bottom: 20px; right: 20px; z-index: 1000; opacity: 0; visibility: hidden; transform: translateY(20px); transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease; }
        #scrollToTopBtn.is-visible { opacity: 1; visibility: visible; transform: translateY(0); }
        #scrollToTopBtn { color: var(--score-average); border-color: var(--score-average); }
        #scrollToTopBtn:hover { color: var(--color-primary); border-color: var(--color-primary); }
        footer { text-align: center; margin-top: 2rem; padding: 2rem 0; color: var(--color-text-secondary); font-size: 0.9em; }
        footer p { margin: 0.25rem 0; }
        footer .copyright { color: var(--color-primary); font-weight: bold; }
        .report-header { text-align: center; margin-top: 1.5rem; margin-bottom: 2.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--color-border); }
        .report-header h2 { font-size: 1.5em; color: var(--color-text-primary); font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 12px; }
        .gender-icon-wrapper { display: flex; gap: 6px; align-items: center; width: auto; height: 28px; color: var(--color-primary); flex-shrink: 0; }
        .gender-icon { width: 28px; height: 28px; }
        .report-header h2:not([data-gender="male"]) .icon-male { display: none; }
        .report-header h2:not([data-gender="female"]) .icon-female { display: none; }
        .report-header h2:not([data-gender="neutral"]) .icon-neutral { display: none; }
        .report-header h3 { color: var(--color-text-secondary); font-weight: 400; font-style: italic; margin-top: 8px; display: flex; align-items: center; justify-content: center; gap: 0.5em; }
        .report-header h3 svg { width: 24px; height: 24px; color: var(--score-average); }

        /* ============================================= */
        /* ================ CARD STYLES ================ */
        /* ============================================= */
        .card { background-color: var(--color-surface); border-radius: 12px; padding: 30px; margin-bottom: 25px; border: 1px solid var(--color-border); box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: all 0.3s; }
        .card.is-hidden { display: none; }
        .card h2 { color: var(--color-text-primary); font-size: 1.4em; font-weight: 600; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--color-border); display: flex; justify-content: space-between; align-items: center; gap: 15px; }
        .card h2 > span { flex-grow: 1; display: flex; align-items: center; gap: 0.75em; }
        .card h2 > span svg { width: 24px; height: 24px; color: var(--color-primary); flex-shrink: 0; }
        .action-button { background: none; border: 1px solid var(--color-border); color: var(--color-text-secondary); cursor: pointer; border-radius: 6px; padding: 6px 8px; display: flex; align-items: center; gap: 6px; transition: all 0.2s ease; font-size: 0.8em; flex-shrink: 0; }
        .action-button:hover { color: var(--color-primary); border-color: currentColor; }
        .category-weight { font-size: 0.8em; font-weight: 500; padding: 4px 8px; border-radius: 6px; background-color: var(--color-bg); border: 1px solid var(--color-border); }
        .task-header { font-size: 1.1em; font-weight: 600; display: flex; justify-content: space-between; align-items: center; gap: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--color-border); margin-bottom: 15px; }
        .task-header span {background-color: var(--color-surface); flex-grow: 1; }

        /* Summary Grid in Summary Card */
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .summary-block { padding: 20px; border-radius: 8px; border: 1px solid var(--color-border); }
        .summary-block h4 { margin-top: 0; margin-bottom: 15px; font-size: 1.1em; }
        .summary-block ul { list-style: none; padding-left: 5px; } .summary-block ul li { margin-bottom: 10px; }
        .summary-block.pros-block { border-left: 4px solid var(--score-good); }
        .summary-block.risks-block { border-left: 4px solid var(--danger-color); }
        .summary-block.verdict-block, .summary-block.recommendation-block { grid-column: 1 / -1; }

        /* ============================================= */
        /* ======== COMPETENCY BLOCK LIST STYLES ======= */
        /* ============================================= */
        .competency-list { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 12px; margin-top: 5px; }
        .competency-list li { background-color: var(--color-bg); border: 1px solid var(--color-border); border-radius: 8px; padding: 15px 20px; position: relative; padding-left: 40px; }
        .competency-list li::before { content: ''; position: absolute; left: 15px; top: 21px; width: 10px; height: 10px; border-radius: 50%; }
        .competency-list li.score-good::before { background-color: var(--score-good); }
        .competency-list li.score-average::before { background-color: var(--score-average); }
        .competency-list li.score-bad::before { background-color: var(--score-bad); }
        .competency-name { font-weight: 600; display: block; margin-bottom: 4px; color: var(--color-text-primary); display: flex; justify-content: space-between; align-items: center; }
        .item-weight { font-size: 0.8em; font-weight: 500; color: var(--color-text-secondary); }
        .competency-justification { font-size: 0.9em; color: var(--color-text-secondary); line-height: 1.5; margin: 0; }
        
        /* ============================================= */
        /* ============= SPECIFIC COMPONENTS =========== */
        /* ============================================= */
        .grade-card .grade-value { font-size: 1.6em; font-weight: bold; padding: 12px; border: 1px solid var(--color-border); border-radius: 8px; text-align: center; margin-bottom: 15px; }
        /* Automatic grade styling */
        .grade-value.grade-bad { background-color: var(--score-bad); color: var(--color-bg); }
        .grade-value.grade-average { background-color: var(--score-average); color: var(--color-bg); }
        .grade-value.grade-good { background-color: var(--score-good); color: var(--color-bg); }

        pre { background-color: var(--color-surface-hover); padding: 15px; border-radius: 8px; overflow-x: auto; font-family: 'SF Mono', 'Fira Code', 'Roboto Mono', monospace; font-size: 15px; line-height: 1.6; border: 1px solid var(--color-border); margin-top: 0; white-space: pre-wrap; word-break: break-word; max-height: 400px; overflow-y: auto; }
        
        #card-doubts h2 > span svg { color: var(--score-average); } /* Risk section icon color */
        .question-list { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 15px; margin-top: 15px; }
        .question-list li { padding: 15px; border: 1px solid var(--color-border); border-left-width: 4px; border-radius: 8px; background-color: var(--color-bg); margin: 0; }
        .question-list .question-critical { border-left-color: var(--danger-color); }
        .question-list .question-regular { border-left-color: var(--score-average); }
        .risk-title { font-weight: 600; color: var(--color-text-secondary); font-size: 0.9em; margin-bottom: 8px; }
        .verification-question { margin: 0; font-style: italic; }

        /* Test Assignment Card Buttons */
        #card-test-assignment .action-button {
            color: var(--score-average);
            border-color: var(--score-average);
        }
        #card-test-assignment .action-button:hover {
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        /* --- Final Assessment Section --- */
        #card-final-assessment h2 { font-size: 1.4em; margin-bottom: 25px; }
        .assessment-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px 25px; }
        .assessment-block { background-color: var(--color-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--color-border); }
        .assessment-block h3 { font-size: 1.1em; font-weight: 600; margin-top: 0; padding-bottom: 10px; color: var(--color-text-primary); border-bottom: 1px solid var(--color-border); }
        #assessment-block-visualizer .score-display { margin-top: 10px; }
        #assessment-block-visualizer .score-label { font-size: 0.9em; color: var(--color-text-secondary); }
        #assessment-block-visualizer .score-value { font-size: 1.4em; font-weight: bold; padding: 4px 8px; border-radius: 6px; color: #fff; }
        #assessment-block-visualizer .score-value.score-bad { background-color: var(--score-bad); color: var(--color-bg); }
        #assessment-block-visualizer .score-value.score-average { background-color: var(--score-average); color: var(--color-bg); }
        #assessment-block-visualizer .score-value.score-good { background-color: var(--score-good); color: var(--color-bg); }
        #assessment-block-verification ul { list-style: none; padding: 0; margin-top: 10px; font-size: 0.9em; }
        #assessment-block-verification li { display: flex; justify-content: space-between; margin-bottom: 8px; }
        #assessment-block-verification .risk-value { font-weight: 600; color: var(--color-primary); }
        .scenario-list, .plan-list { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 15px; margin-top: 15px; }
        .scenario-list .scenario, .plan-list .plan-step { padding: 15px; border-radius: 8px; background-color: var(--color-surface); margin: 0; border: 1px solid var(--color-border); border-left-width: 4px; }
        .scenario.scenario-success { border-left-color: var(--score-good); }
        .plan-list .plan-step { border-left-color: var(--color-primary); }
        .scenario.scenario-partial { border-left-color: var(--score-average); }
        .scenario.scenario-danger { border-left-color: var(--danger-color); }
        .task-block-wrapper { display: grid; grid-template-columns: 1fr; gap: 20px; font-size: 0.9em; color: var(--color-text-primary); }
        
        /* ============================================= */
        /* ================ MEDIA QUERIES ============== */
        /* ============================================= */
        @media (min-width: 1025px) { 
            .container { width: 80%; } 
            .task-block-wrapper { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 900px) {
            .assessment-grid { grid-template-columns: 1fr; }
            .assessment-block#assessment-block-scenarios, .assessment-block#assessment-block-recommendation { grid-column: auto; }
        }
        @media (max-width: 768px) {
            body { font-size: 14px; }
            .controls-panel { flex-wrap: nowrap; position: relative;}
            #header-title { display: none; }
            #search-toggle-btn { display: flex; }
            #searchInput { display: none; position: absolute; top: calc(100% + 10px); left: 0; right: 0; width: 100%; z-index: 10; }
            #controls-section.is-search-open { padding-bottom: 66px; }
            #controls-section.is-search-open #searchInput { display: block; }
            .summary-grid { grid-template-columns: 1fr; }
            .dropdown-wrapper { position: static; }
            .dropdown-menu { width: calc(100% - 40px); left: 20px; right: 20px; }
        }

        @media print {
            body { font-size: 10pt; color: #000; }
            #header-title { display: block !important; }
            .container { width: 100%; max-width: 100%; padding: 0; }
            #controls-section, #scrollToTopBtn, footer { display: none; }
            .card { box-shadow: none; border: 1px solid #ddd; page-break-inside: avoid; }
            .assessment-block, .competency-list li, .scenario-list li, .question-list li, .plan-list li, .task-block { page-break-inside: avoid; }
            pre { max-height: none !important; overflow-y: visible !important; }
        }
    </style>
</head>
<body>

    <!-- ============================================= -->
    <!-- ============== CONTROLS SECTION ============= -->
    <!-- ============================================= -->
    <header id="controls-section">
        <div class="container">
            <div class="controls-panel">
                <h1 id="header-title">Hiring CoPilot</h1>
                <button id="search-toggle-btn" class="control-btn" title="Поиск по отчету"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button>
                <button id="theme-switcher" class="control-btn" title="Сменить тему" aria-label="Сменить тему"><svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg><svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button>
                <input type="search" id="searchInput" placeholder="Поиск по отчету...">
                <div class="dropdown-wrapper">
                  <button id="section-selector-btn" class="control-btn" title="Перейти к секции" aria-haspopup="true" aria-expanded="false" aria-label="Перейти к секции"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg></button>
                  <div id="section-selector-dropdown" class="dropdown-menu"></div>
                </div>
                <div class="dropdown-wrapper">
                    <button id="actions-btn" class="control-btn" title="Действия" aria-haspopup="true" aria-expanded="false" aria-label="Действия"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg></button>
                    <div id="actions-dropdown" class="dropdown-menu">
                        <div class="action-item"><button id="save-report-pdf" class="btn-action">Сохранить в PDF</button></div>
                        <div class="action-item"><div class="email-group"><input type="email" id="recipient-email" class="email-input" placeholder="Email получателя"></div></div>
                        <div class="action-item"><button id="send-report-email" class="btn-action">Сформировать Email</button></div>
                    </div>
                </div>
            </div>
        </div> 
    </header>

    <!-- ============================================= -->
    <!-- ================ MAIN CONTENT =============== -->
    <!-- ============================================= -->
    <main>
        <div class="container">
            <!-- Report Header -->
            <div class="report-header">
                <!-- Установите один data-gender: "male", "female", или "neutral" для отображения нужной иконки -->
                <h2 data-gender="neutral">
                    <span class="gender-icon-wrapper">
                        <svg class="gender-icon icon-male" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                        <svg class="gender-icon icon-female" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><polyline points="17 11 22 16"></polyline><polyline points="22 11 17 16"></polyline></svg>
                        <svg class="gender-icon icon-neutral" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle></svg>
                    </span>
                    <span>Кандидат: [Имя Фамилия]</span>
                </h2>
                <!-- Измените текст ниже для выбора соответствующего профиля весов из JSON-конфигурации -->
                <h3 id="position-title"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg><span>Позиция: [Название Позиции]</span></h3>
            </div>
            
            <!-- Summary Card -->
            <div id="card-summary" class="card" data-integrity-risk="true">
                <h2><span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> Overview</span></h2>
                <div class="summary-grid">
                    <div class="summary-block verdict-block">
                        <p>Кандидат демонстрирует **[сильный/средний/слабый]** уровень соответствия. Основные сильные стороны лежат в области [область 1] и [область 2]. Главный вопрос для проверки — [ключевой вопрос или риск]. Необходимо убедиться, что цели компании совпадают с амбициями кандидата.</p>
                    </div>
                    <div class="summary-block pros-block"><h4>Ключевые плюсы</h4><ul><li>Пример сильной стороны кандидата, основанный на опыте.</li><li>Еще одна сильная сторона, подтвержденная цифрами или фактами.</li><li>Ключевое достижение, релевантное для позиции.</li><li>Навык или качество, важное для команды.</li></ul></div>
                    <div class="summary-block risks-block"><h4>Основные риски</h4><ul><li><strong>(КРИТИЧЕСКИЙ)</strong> Пример критического риска, который может блокировать найм.</li><li>Пример риска средней степени, требующий верификации.</li><li>Пример менее значительного риска или "красного флага".</li></ul></div>
                </div>
            </div>
            
            <!-- Skills & Formal Cards -->
            <div id="card-hard-skills" class="card"><h2><span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2l-4.5 4.5L14 11l-1.5 1.5L8 8l-4.5 4.5L8 17l1.5 1.5L5 14l4.5-4.5L14 14l-1.5 1.5L8 11l4.5 4.5L17 11l-1.5-1.5L11 14l4.5-4.5L20 14"></path></svg> Hard Skills</span><span class="category-weight"></span></h2><ul class="competency-list"><li class="score-good"><span class="competency-name">Ключевая компетенция 1<span class="item-weight"></span></span><p class="competency-justification">"Цитата из резюме или пример, подтверждающий высокий уровень владения."</p></li><li class="score-average"><span class="competency-name">Ключевая компетенция 2<span class="item-weight"></span></span><p class="competency-justification">Обоснование, почему навык оценен как средний (например, устаревший опыт).</p></li><li class="score-bad"><span class="competency-name">Ключевая компетенция 3<span class="item-weight"></span></span><p class="competency-justification">Обоснование низкой оценки (например, отсутствие упоминаний в резюме).</p></li></ul></div>
            <div id="card-tech-stack" class="card"><h2><span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg> Software</span><span class="category-weight"></span></h2><ul class="competency-list"><li class="score-good"><span class="competency-name">Технология / Инструмент 1<span class="item-weight"></span></span><p class="competency-justification">Пример, демонстрирующий экспертное владение.</p></li><li class="score-average"><span class="competency-name">Технология / Инструмент 2<span class="item-weight"></span></span><p class="competency-justification">Упомянут в опыте, но требует проверки на актуальность.</p></li><li class="score-good"><span class="competency-name">Технология / Инструмент 3<span class="item-weight"></span></span><p class="competency-justification">Критически важный инструмент для данной роли.</p></li></ul></div>
            <div id="card-soft-skills" class="card"><h2><span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg> Soft Skills</span><span class="category-weight"></span></h2><ul class="competency-list"><li class="score-good"><span class="competency-name">Гибкий навык 1 (например, Проактивность)<span class="item-weight"></span></span><p class="competency-justification">Пример из карьерного пути, демонстрирующий это качество.</p></li><li class="score-good"><span class="competency-name">Гибкий навык 2 (например, Коммуникация)<span class="item-weight"></span></span><p class="competency-justification">Оценка на основе качества резюме или сопроводительного письма.</p></li><li class="score-average"><span class="competency-name">Гибкий навык 3 (например, Работа в команде)<span class="item-weight"></span></span><p class="competency-justification">Требует дополнительной проверки на собеседовании.</p></li><li class="score-bad"><span class="competency-name">Гибкий навык 4 (например, Работа с ИИ)<span class="item-weight"></span></span><p class="competency-justification">Нет упоминаний об использовании современных инструментов.</p></li></ul></div>
            <div id="card-formal" class="card"><h2><span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v15H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> Add. Info</span><span class="category-weight"></span></h2><ul class="competency-list"><li class="score-good"><span class="competency-name">Уровень иностранного языка<span class="item-weight"></span></span><p class="competency-justification">Указан уровень '[Proficiency Level]'.</p></li><li class="score-good"><span class="competency-name">Профильное образование<span class="item-weight"></span></span><p class="competency-justification">Наличие степени в [Название области].</p></li><li class="score-average"><span class="competency-name">Курсы и сертификаты<span class="item-weight"></span></span><p class="competency-justification">Есть сертификаты, но их релевантность требует уточнения.</p></li></ul></div>
            <div id="card-grade" class="card grade-card"><h2><span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg> Pre-Grade</span></h2><div class="grade-value">Middle / Intermediate</div><p><strong>Обоснование:</strong> Опыт кандидата соответствует требованиям для уровня [Junior/Middle/Senior/Lead/Head].</p></div>
            
            <!-- Doubts Section -->
            <div id="card-doubts" class="card">
                <h2><span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> Risk / Verification</span></h2>
                <ul class="question-list">
                    <li class="question-critical"><div class="risk-title"><strong>РИСК:</strong> [Формулировка критического риска]</div><p class="verification-question">Пример вопроса для проверки критического риска.</p></li>
                    <li class="question-regular"><div class="risk-title">РИСК: [Формулировка обычного риска]</div><p class="verification-question">Пример вопроса для проверки обычного риска.</p></li>
                    <li class="question-regular"><div class="risk-title">РИСК: [Формулировка обычного риска]</div><p class="verification-question">Еще один пример вопроса для верификации.</p></li>
                </ul>
            </div>
            
            <!-- Final Assessment Card -->
            <div id="card-final-assessment" class="card">
                <h2><span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg> Scoring</span></h2>
                <div class="assessment-grid">
                    <div id="assessment-block-visualizer" class="assessment-block">
                        <h3>Текущая Оценка</h3>
                        <div class="score-display">
                            <span id="current-score-value" class="score-value"></span>
                        </div>
                        <div class="score-display" style="margin-top: 15px;">
                           <h3>Потенциальная Оценка</h3>
                            <span id="potential-score-value" class="score-value"></span>
                        </div>
                    </div>
                    <div id="assessment-block-verification" class="assessment-block">
                        <h3>Пункты для верификации:</h3>
                        <ul id="verification-list"></ul>
                    </div>
                    <div id="assessment-block-scenarios" class="assessment-block">
                        <h3>Variations</h3>
                        <ul class="scenario-list">
                            <li class="scenario scenario-success"><p><strong>Сценарий 1: Успешная верификация.</strong> [Описание позитивного исхода интервью].<br><strong>Решение:</strong> Готовить оффер на позицию [Название Позиции].</p></li>
                            <li class="scenario scenario-partial"><p><strong>Сценарий 2: Частичное подтверждение.</strong> [Описание промежуточного исхода].<br><strong>Решение:</strong> Рассмотреть на альтернативную роль [Название альтернативной позиции] или провести дополнительный этап.</p></li>
                            <li class="scenario scenario-danger"><p><strong>Сценарий 3: Подтверждение несоответствий.</strong> [Описание негативного исхода].<br><strong>Решение:</strong> Отклонить кандидатуру.</p></li>
                        </ul>
                    </div>
                    <div id="assessment-block-recommendation" class="assessment-block">
                        <h3>Plan / Script</h3>
                        <ul class="plan-list">
                            <li class="plan-step"><strong>Этап 1: [Тема для обсуждения 1] (15 мин).</strong> Задать вопросы из блока "Risk / Verification".</li>
                            <li class="plan-step"><strong>Этап 2: [Тема для обсуждения 2] (25 мин).</strong> Глубоко погрузиться в опыт по [ключевой компетенции].</li>
                            <li class="plan-step"><strong>Этап 3: [Тема для обсуждения 3] (15 мин).</strong> Обсудить [доменные или технические вопросы].</li>
                            <li class="plan-step"><strong>Этап 4: Q&A (5 мин).</strong> Ответы на вопросы кандидата.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Test Assignment Section -->
            <div id="card-test-assignment" class="card">
                <h2><span>Test Assignment</span></h2>
                <div class="task-block-wrapper">
                    <div class="task-block">
                        <div class="task-header">
                           <h3><span>Пример тестового задания</span></h3>
                           <button class="action-button" id="download-task-md-btn" title="Сохранить задание в .md"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg></button>
                        </div>
                        <pre><code id="test-assignment-md">## Кейс-стади: [Название задачи]

**Контекст:**
[Описание общей ситуации и проблемы, которую нужно решить. Например, запуск нового продукта, оптимизация процесса и т.д.]

### Требования к ответу (формат и время):
1.  **Пункт 1:** [Описание первого требования к решению].
2.  **Пункт 2:** [Описание второго требования к решению].
3.  **Пункт 3:** [Описание третьего требования к решению].
4.  **Пункт 4:** [Описание критериев успеха или ключевых метрик].
</code></pre>
                    </div>
                    <div class="task-block">
                         <div class="task-header">
                            <h3><span>Пример формы оценки</span></h3>
                            <button class="action-button" id="download-evaluation-md-btn" title="Сохранить форму оценки в .md"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg></button>
                        </div>
                        <pre><code id="evaluation-form-md">| Критерий                  | Оценка (1-5) | Комментарии                                |
|---------------------------|:------------:|--------------------------------------------|
| **Критерий оценки 1**     |              | Глубина анализа, структурированность.      |
| **Критерий оценки 2**     |              | Реалистичность предложений, бизнес-логика. |
| **Критерий оценки 3**     |              | Учет рисков и ограничений.                 |
| **Фокус на KPI**          |              | Выбор релевантных метрик, data-driven подход.|
</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ============================================= -->
    <!-- =================== FOOTER ================== -->
    <!-- ============================================= -->
    <footer>
        <p>Generated by MAE OMA-II / HRCV</p>
        <p class="copyright">© <span id="copyright-year"></span> McBile AI-Engine</p>
    </footer>

    <!-- ============================================= -->
    <!-- ============== UTILITY ELEMENTS ============= -->
    <!-- ============================================= -->
    <button id="scrollToTopBtn" class="control-btn" title="Scroll to top" aria-label="Scroll to top"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg></button>
    
    <!-- ============================================= -->
    <!-- =========== CONFIGURATION DATA ============== -->
    <!-- ============================================= -->
    <script id="weighting-profiles-data" type="application/json">
    {
        "Пример Профиля 1": {
            "sections": { "hard-skills": 35, "tech-stack": 10, "soft-skills": 45, "formal": 10 },
            "items": { "hard-skills": [50, 30, 20], "tech-stack": [20, 40, 40], "soft-skills": [50, 25, 15, 10], "formal": [30, 50, 20] }
        },
        "Пример Профиля 2": {
            "sections": { "hard-skills": 25, "tech-stack": 45, "soft-skills": 20, "formal": 10 },
            "items": { "hard-skills": [30, 40, 30], "tech-stack": [50, 30, 20], "soft-skills": [40, 30, 20, 10], "formal": [20, 40, 40] }
        },
        "Default": {
            "sections": { "hard-skills": 35, "tech-stack": 30, "soft-skills": 25, "formal": 10 },
            "items": { "hard-skills": [45, 30, 25], "tech-stack": [45, 30, 25], "soft-skills": [45, 25, 15, 15], "formal": [40, 40, 20] }
        }
    }
    </script>

    <!-- ============================================= -->
    <!-- ============== MAIN SCRIPT ================== -->
    <!-- ============================================= -->
    <script>
        /* ============================================= */
        /* ============== VERSION 1.0.0 ================ */
        /* ============================================= */
        (() => {
            // ========== MODULE: CONFIGURATION ==========
            const getConfig = () => {
                try {
                    return JSON.parse(D.getElementById('weighting-profiles-data').textContent);
                } catch (e) {
                    console.error("Error parsing weighting profiles:", e);
                    return { "Default": { sections: {}, items: {} } };
                }
            };

            // ========== DOM ELEMENTS & STATE ==========
            const D = document;
            const DOM = {
                htmlElement: D.documentElement,
                controlsSection: D.getElementById('controls-section'),
                themeSwitcher: D.getElementById('theme-switcher'),
                searchToggleBtn: D.getElementById('search-toggle-btn'),
                searchInput: D.getElementById('searchInput'),
                sectionSelectorBtn: D.getElementById('section-selector-btn'),
                sectionSelectorDropdown: D.getElementById('section-selector-dropdown'),
                actionsBtn: D.getElementById('actions-btn'),
                actionsDropdown: D.getElementById('actions-dropdown'),
                savePdfBtn: D.getElementById('save-report-pdf'),
                sendEmailBtn: D.getElementById('send-report-email'),
                emailInput: D.getElementById('recipient-email'),
                scrollToTopBtn: D.getElementById('scrollToTopBtn'),
                allCards: D.querySelectorAll('.card'),
                copyrightYearSpan: D.getElementById('copyright-year'),
                positionTitleEl: D.getElementById('position-title'),
                gradeValueEl: D.querySelector('.grade-card .grade-value'),
                currentScoreEl: D.getElementById('current-score-value'),
                potentialScoreEl: D.getElementById('potential-score-value'),
                verificationListEl: D.getElementById('verification-list'),
            };
            const weightingProfiles = getConfig();

            // ========== MODULE: UI HANDLERS ==========
            const applyTheme = (theme) => { DOM.htmlElement.setAttribute('data-theme', theme); localStorage.setItem('cvReportTheme', theme); };
            const toggleDropdown = (btn, menu) => { const isOpen = menu.classList.toggle('is-open'); btn.setAttribute('aria-expanded', isOpen); };
            const downloadMarkdown = (content, fileName) => {
                const blob = new Blob([content], { type: 'text/markdown;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = D.createElement('a'); a.href = url; a.download = fileName;
                D.body.appendChild(a); a.click(); D.body.removeChild(a); URL.revokeObjectURL(url);
            };
            
            // ========== MODULE: DYNAMIC CONTENT ==========
            const populateSectionSelector = () => {
                const menuItems = [
                    { name: 'Hard Skills', href: '#card-hard-skills' },
                    { name: 'Soft Skills', href: '#card-soft-skills' },
                    { name: 'Pre-Grade', href: '#card-grade' },
                    { name: 'Scoring', href: '#card-final-assessment' },
                    { name: 'Plan', href: '#assessment-block-recommendation' },
                    { name: 'Testing', href: '#card-test-assignment' }
                ];
                let fragment = D.createDocumentFragment();
                menuItems.forEach(item => {
                    const link = D.createElement('a');
                    link.href = item.href;
                    link.textContent = item.name;
                    fragment.appendChild(link);
                });
                DOM.sectionSelectorDropdown.innerHTML = '';
                DOM.sectionSelectorDropdown.appendChild(fragment);
            };

            const setWeights = () => {
                const positionText = DOM.positionTitleEl.querySelector('span').textContent.replace('Позиция: ', '').trim();
                const profile = weightingProfiles[positionText] || weightingProfiles.Default;
                for (const [sectionId, sectionWeight] of Object.entries(profile.sections)) {
                    const sectionEl = D.getElementById(`card-${sectionId}`);
                    if (sectionEl) {
                        sectionEl.querySelector('.category-weight').textContent = `[${sectionWeight}%]`;
                        const itemWeights = profile.items[sectionId];
                        if (itemWeights) {
                            sectionEl.querySelectorAll('.competency-list li').forEach((li, index) => {
                                if (itemWeights[index] !== undefined) {
                                    const weightSpan = li.querySelector('.item-weight');
                                    if (weightSpan) weightSpan.textContent = `[${itemWeights[index]}%]`;
                                }
                            });
                        }
                    }
                }
            };
            
            /**
             * Applies styling to the grade value block based on its text content.
             */
            const applyGradeStyling = () => {
                if (!DOM.gradeValueEl) return;
                const text = DOM.gradeValueEl.textContent.toLowerCase();
                let gradeClass = 'grade-bad'; // Default class
                
                if (/\b(senior|lead|head)\b/.test(text)) {
                    gradeClass = 'grade-good';
                } else if (/\b(middle|mid|intermediate)\b/.test(text)) {
                    gradeClass = 'grade-average';
                }
                
                DOM.gradeValueEl.classList.add(gradeClass);
            };

            // ========== MODULE: SCORING LOGIC ==========
            const getScoreColorClass = (score) => {
                if (score < 3.0) return 'score-bad';
                if (score < 4.2) return 'score-average';
                return 'score-good';
            };

            const calculateScores = () => {
                const scoreMap = { "score-good": 5, "score-average": 3, "score-bad": 1 };
                const potentialScoreMap = { "score-good": 5, "score-average": 5, "score-bad": 1 };
                let pointsToVerify = [];
                let totalCurrentScore = 0;
                let totalPotentialScore = 0;
                let totalCategoryWeight = 0;

                const positionText = DOM.positionTitleEl.querySelector('span').textContent.replace('Позиция: ', '').trim();
                const profile = weightingProfiles[positionText] || weightingProfiles.Default;

                for (const sectionId of Object.keys(profile.sections)) {
                    const card = D.getElementById(`card-${sectionId}`);
                    if (!card) continue;
                    const sectionWeight = profile.sections[sectionId];
                    const itemWeights = profile.items[sectionId];
                    let sectionCurrentPoints = 0, sectionPotentialPoints = 0, sectionTotalWeight = 0;
                    
                    card.querySelectorAll('.competency-list li').forEach((item, index) => {
                        const scoreClass = [...item.classList].find(c => c.startsWith('score-'));
                        const weight = itemWeights ? itemWeights[index] : 0;
                        if (scoreClass && weight > 0) {
                            const currentScore = scoreMap[scoreClass];
                            const potentialScore = potentialScoreMap[scoreClass];
                            sectionCurrentPoints += currentScore * weight;
                            sectionPotentialPoints += potentialScore * weight;
                            sectionTotalWeight += weight;
                            if (scoreClass === 'score-average') {
                                const rawImpact = (potentialScore - currentScore) * weight;
                                pointsToVerify.push({ name: item.querySelector('.competency-name').textContent.replace(/\[\d+%\]$/, '').trim(), impact: rawImpact, sectionWeight: sectionWeight, sectionTotalWeight: 0});
                            }
                        }
                    });
                    
                    if (sectionTotalWeight > 0) {
                        pointsToVerify.forEach(p => { if (p.sectionWeight === sectionWeight) p.sectionTotalWeight = sectionTotalWeight; });
                        totalCurrentScore += (sectionCurrentPoints / sectionTotalWeight) * sectionWeight;
                        totalPotentialScore += (sectionPotentialPoints / sectionTotalWeight) * sectionWeight;
                        totalCategoryWeight += sectionWeight;
                    }
                }
                
                let currentAverage = totalCategoryWeight > 0 ? totalCurrentScore / totalCategoryWeight : 0;
                let potentialAverage = totalCategoryWeight > 0 ? totalPotentialScore / totalCategoryWeight : 0;

                if (D.querySelector('[data-integrity-risk="true"]')) {
                    const originalAverage = currentAverage;
                    currentAverage *= 0.75;
                    const integrityImpact = originalAverage - currentAverage;
                    pointsToVerify.unshift({ name: "Критический риск для верификации", impact: integrityImpact, isIntegrityRisk: true });
                }

                // Finalize impact calculation to ensure sum matches delta
                const totalDelta = potentialAverage - currentAverage;
                let totalRawImpact = 0;
                let integrityRiskValue = 0;

                pointsToVerify.forEach(p => {
                    if (p.isIntegrityRisk) {
                        integrityRiskValue = p.impact;
                    } else {
                        p.impact = (p.impact / p.sectionTotalWeight * p.sectionWeight) / totalCategoryWeight;
                        totalRawImpact += p.impact;
                    }
                });

                if (totalRawImpact > 0) {
                    const nonIntegrityDelta = totalDelta - integrityRiskValue;
                    const scalingFactor = nonIntegrityDelta / totalRawImpact;
                    pointsToVerify.forEach(p => { if (!p.isIntegrityRisk) p.impact *= scalingFactor; });
                }

                return { currentAverage, potentialAverage, pointsToVerify };
            };

            const renderScores = ({ currentAverage, potentialAverage, pointsToVerify }) => {
                if (!DOM.verificationListEl || !DOM.currentScoreEl || !DOM.potentialScoreEl) return;
                
                DOM.currentScoreEl.textContent = `${currentAverage.toFixed(2)} / 5.0`;
                DOM.currentScoreEl.className = 'score-value ' + getScoreColorClass(currentAverage);
                DOM.potentialScoreEl.textContent = `${potentialAverage.toFixed(2)} / 5.0`;
                DOM.potentialScoreEl.className = 'score-value ' + getScoreColorClass(potentialAverage);
                
                DOM.verificationListEl.innerHTML = '';
                if (pointsToVerify.length > 0) {
                    let fragment = D.createDocumentFragment();
                    pointsToVerify.sort((a, b) => b.impact - a.impact).forEach(point => {
                        const li = D.createElement('li');
                        li.innerHTML = `<span>${point.name}</span> <span class="risk-value">+${point.impact.toFixed(2)}</span>`;
                        fragment.appendChild(li);
                    });
                    DOM.verificationListEl.appendChild(fragment);
                } else {
                    DOM.verificationListEl.innerHTML = '<li>Все пункты оценены максимально.</li>';
                }
            };
            
            // ========== MODULE: EVENT LISTENERS ==========
            function setupEventListeners() {
                DOM.themeSwitcher.addEventListener('click', () => applyTheme(DOM.htmlElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'));
                DOM.searchToggleBtn.addEventListener('click', () => DOM.controlsSection.classList.toggle('is-search-open'));
                DOM.searchInput.addEventListener('input', () => { const query = DOM.searchInput.value.toLowerCase().trim(); DOM.allCards.forEach(card => card.classList.toggle('is-hidden', query && !card.innerText.toLowerCase().includes(query))); });
                DOM.sectionSelectorBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleDropdown(DOM.sectionSelectorBtn, DOM.sectionSelectorDropdown); });
                DOM.sectionSelectorDropdown.addEventListener('click', (e) => { if (e.target.tagName === 'A') { toggleDropdown(DOM.sectionSelectorBtn, DOM.sectionSelectorDropdown); } });
                DOM.actionsBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleDropdown(DOM.actionsBtn, DOM.actionsDropdown); });
                DOM.savePdfBtn.addEventListener('click', () => window.print());
                DOM.sendEmailBtn.addEventListener('click', () => {
                    const recipient = DOM.emailInput.value; if (!recipient) { alert('Пожалуйста, введите email получателя.'); return; }
                    
                    alert('Будет открыт ваш почтовый клиент. Пожалуйста, предварительно сохраните отчет в PDF (Действия -> Сохранить в PDF) и прикрепите файл к письму вручную.');

                    const candidateName = D.querySelector('.report-header h2 span:last-child').textContent.replace('Кандидат: ', '').trim();
                    const positionName = D.querySelector('#position-title span').textContent.replace('Позиция: ', '').trim();
                    const subject = encodeURIComponent(`Отчет по кандидату: ${candidateName} на позицию ${positionName}`);
                    const summary = D.querySelector('#assessment-block-recommendation').innerText.trim();
                    const comments = D.querySelector('.summary-block.verdict-block p').innerText.trim();
                    let bodyText = `Здравствуйте,\n\nВо вложении находится полный отчет по кандидату.\n\nКандидат: ${candidateName}\nПозиция: ${positionName}\n\nКлючевые рекомендации:\n${summary}\n\n`;
                    if (comments) bodyText += `Общий вердикт:\n"${comments}"\n\n`;
                    bodyText += 'С уважением,\nHiring CoPilot.';
                    window.location.href = `mailto:${recipient}?subject=${subject}&body=${encodeURIComponent(bodyText)}`;
                });

                D.getElementById('download-task-md-btn').addEventListener('click', () => {
                   const mdContent = D.getElementById('test-assignment-md').textContent;
                   downloadMarkdown(mdContent, 'Test-Assignment-Template.md');
                });
                D.getElementById('download-evaluation-md-btn').addEventListener('click', () => {
                   const mdContent = D.getElementById('evaluation-form-md').textContent;
                   downloadMarkdown(mdContent, 'Evaluation-Form-Template.md');
                });

                D.addEventListener('click', (e) => { if (!DOM.sectionSelectorDropdown.contains(e.target) && !DOM.sectionSelectorBtn.contains(e.target)) { DOM.sectionSelectorDropdown.classList.remove('is-open'); DOM.sectionSelectorBtn.setAttribute('aria-expanded', 'false'); } if (!DOM.actionsDropdown.contains(e.target) && !DOM.actionsBtn.contains(e.target)) { DOM.actionsDropdown.classList.remove('is-open'); DOM.actionsBtn.setAttribute('aria-expanded', 'false'); } });
                window.addEventListener('scroll', () => { DOM.scrollToTopBtn.classList.toggle('is-visible', window.scrollY > 300); });
                DOM.scrollToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            }

            // ========== INITIALIZATION ==========
            function init() {
                DOM.copyrightYearSpan.textContent = new Date().getFullYear();
                applyTheme(localStorage.getItem('cvReportTheme') || 'dark');
                setWeights();
                applyGradeStyling(); 
                setupEventListeners();
                const scores = calculateScores();
                renderScores(scores);
                populateSectionSelector();
            }

            init();
        })();
    </script>
</body>
</html>
